String.prototype.format=String.prototype.f=function(){var b=this,a=arguments.length;while(a--){b=b.replace(new RegExp("\\{"+a+"\\}","gm"),arguments[a])}return b};tl=window.tl||{};tl.pg=tl.pg||{};tl.pg.default_prefs={auto_show_first:true,loading_selector:"#loading",track_events_cb:function(){return}};tl.pg.init=function(d){if(jQuery("#tlyPageGuide").length===0){return}var a=jQuery("#tlyPageGuide"),e=jQuery("<div>",{id:"tlyPageGuideWrapper"}),b=jQuery("<div>",{id:"tlyPageGuideMessages"});b.append(d&&d.pageguide_close?d.pageguide_close:'<a title="Close Guide" class="tlypageguide_close" href="#">close</a><span></span><div></div><a title="Next" class="tlypageguide_back" href="#">Previous</a><a title="Next" class="tlypageguide_fwd" href="#">Next</a>');e.append(d&&d.pageguide_toggle?d.pageguide_toggle:'<div title="Launch Page Guide" class="tlypageguide_toggle" style="right: -120px;">page guide<div><span>Launch Page Guide</span></div><a title="close guide" href="javascript:void(0);">close guide &raquo;</a></div>');e.append(a);e.append(b);jQuery("body").append(e);var c=new tl.pg.PageGuide(jQuery("#tlyPageGuideWrapper"),d);c.ready(function(){c.setup_handlers();c.$base.children(".tlypageguide_toggle").animate({right:"-120px"},250)});return c};tl.pg.PageGuide=function(a,b){this.preferences=jQuery.extend({},tl.pg.default_prefs,b);this.$base=a;this.$all_items=jQuery("#tlyPageGuide > li",this.$base);this.$items=jQuery([]);this.$message=jQuery("#tlyPageGuideMessages");this.$fwd=jQuery("a.tlypageguide_fwd",this.$base);this.$back=jQuery("a.tlypageguide_back",this.$base);this.cur_idx=0;this.track_event=this.preferences.track_events_cb};tl.pg.isScrolledIntoView=function(d){var b=jQuery(window).scrollTop(),a=b+jQuery(window).height(),e=jQuery(d).offset().top,c=e+jQuery(d).height();return(c>=b)&&(e<=a-100)};tl.pg.PageGuide.prototype.ready=function(a){var c=this,b=window.setInterval(function(){if(!jQuery(c.preferences.loading_selector).is(":visible")){a();clearInterval(b)}},250);return this};tl.pg.PageGuide.prototype._on_expand=function(){var f=this,a=document,b=window;this.position_tour();this.cur_idx=0;var d=a.createElement("style");a.getElementsByTagName("head")[0].appendChild(d);if(!b.createPopup){d.appendChild(a.createTextNode(""));d.setAttribute("type","text/css")}var e=a.styleSheets[a.styleSheets.length-1];var c="";this.$items.each(function(h){var g=jQuery(jQuery(this).data("tourtarget")+":visible:first");g.addClass("tlypageguide_shadow tlypageguide_shadow"+h);var l=".tlypageguide_shadow"+h+":after { height: "+g.outerHeight()+"px; width: "+g.outerWidth(false)+"px; }";if(!b.createPopup){var j=a.createTextNode(l,0);d.appendChild(j)}else{c+=l}jQuery(this).prepend("<ins>"+(h+1)+"</ins>");jQuery(this).data("idx",h)});if(b.createPopup){e.cssText=c}if(this.preferences.auto_show_first&&this.$items.length>0){this.show_message(0)}};tl.pg.PageGuide.prototype.open=function(){this.track_event("PG.open");this._on_expand();this.$items.toggleClass("expanded");jQuery("body").addClass("tlypageguide-open")};tl.pg.PageGuide.prototype.close=function(){this.track_event("PG.close");this.$items.toggleClass("expanded");this.$message.animate({height:"0"},500,function(){jQuery(this).hide()});jQuery("ins").remove();jQuery("body").removeClass("tlypageguide-open")};tl.pg.PageGuide.prototype.setup_handlers=function(){var a=this;jQuery(".tlypageguide_toggle",this.$base).live("click",function(){if(jQuery("body").is(".tlypageguide-open")){a.close()}else{a.open()}return false});jQuery(".tlypageguide_close",this.$message).live("click",function(){a.close();return false});this.$all_items.live("click",function(){var b=jQuery(this).data("idx");a.track_event("PG.specific_elt");a.show_message(b)});this.$fwd.live("click",function(){var b=(a.cur_idx+1)%a.$items.length;a.track_event("PG.fwd");a.show_message(b);return false});this.$back.live("click",function(){var b=(a.cur_idx+a.$items.length-1)%a.$items.length;a.track_event("PG.back");a.show_message(b,true);return false});jQuery(window).resize(function(){a.position_tour()})};tl.pg.PageGuide.prototype.show_message=function(b,a){var d=this.cur_idx,e=this.$items[d],c=this.$items[b];this.cur_idx=b;jQuery("div",this.$message).html(jQuery(c).children("div").html());this.$items.removeClass("tlypageguide-active");jQuery(c).addClass("tlypageguide-active");if(!tl.pg.isScrolledIntoView(jQuery(c))){jQuery("html,body").animate({scrollTop:jQuery(c).offset().top-50},500)}this.$message.not(":visible").show().animate({height:"100px"},500);this.roll_number(jQuery("span",this.$message),jQuery(c).children("ins").html(),a)};tl.pg.PageGuide.prototype.roll_number=function(c,b,a){c.animate({"text-indent":(a?"":"-")+"50px"},"fast",function(){c.html(b);c.css({"text-indent":(a?"-":"")+"50px"},"fast").animate({"text-indent":"0"},"fast")})};tl.pg.PageGuide.prototype.position_tour=function(){this.$items=this.$all_items.filter(function(){return jQuery(jQuery(this).data("tourtarget")).is(":visible")});this.$items.each(function(){var a=jQuery(this),d=jQuery(a.data("tourtarget")).filter(":visible:first"),b=d.offset().left,c=d.offset().top;if(a.hasClass("tlypageguide_top")){c-=60}else{if(a.hasClass("tlypageguide_bottom")){c+=d.outerHeight()+15}else{c+=5}}if(a.hasClass("tlypageguide_right")){b+=d.outerWidth(false)+15}else{if(a.hasClass("tlypageguide_left")){b-=65}else{b+=5}}a.css({left:b+"px",top:c+"px"})})};