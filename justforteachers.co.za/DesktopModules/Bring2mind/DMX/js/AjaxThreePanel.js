var _MouseX=0;var _MouseY=0;var CA_IE=document.all?true:false;var b_mode=document.compatMode=="CSS1Compat"?"S":"Q";var editEntryId;var editParentId;var lastSelectedNode;var lastSearchedNode;var lastSelectedItems;var selectionChanged;var selection;var cbresult;var gridSelectionTitles;var treeSelectionTitle;var autoSelect=false;$(document).ready(function(){$("div.VCBox").bind("contextmenu",function(a){return false});$(document).mousemove(function(a){_MouseX=a.pageX;_MouseY=a.pageY})});function GetConfirmationText(b,a){if(a=="Tree"){return b.replace("{0}",treeSelectionTitle)}else{return b.replace("{0}",gridSelectionTitles)}}function resolveUrl(a){return appPath+a}function itemThumbnail(a){if(a==""||a==null){return""}else{if(isNaN(a)){return'<img src="'+thumbnailPath+a+'" alt="" class="thumbnail" />'}else{return'<img src="'+downloadUrl+"?PortalId="+portalId+"&EntryId="+a+'" alt="" class="thumbnail" />'}}}function attachThumbnailRollovers(){$(".thumbnail").parent().parent().hover(function(a){$(this).children().children(".thumbnail").css({left:a.pageX+10-$(window).scrollLeft(),top:a.pageY+10-$(window).scrollTop()}).fadeIn(300)},function(){$(this).children().children(".thumbnail").fadeOut(100)})}function Grid1_onSortChange(e,d){var c=d.get_descending();var a=d.get_column();var b=5;Grid1.sortMulti([b,!c,a.ColumnNumber,c])}function resizeTree(b,a){updateSizeBox();TreeviewRedraw()}function resizeDetails(b,a){updateSizeBox();DetailsRedraw()}function resizeGrid(b,a){updateSizeBox();GridRedraw(isSplitterLoaded);if(!isSplitterLoaded){FixGridColumnWidths();Grid1.Render()}}function updateSizeBox(){var b;var a=Splitter1.get_panes()[0];b=a.get_width()+"|";b=b+a.get_height()+"|";a=Splitter1.get_panes()[1].get_panes()[0];b=b+a.get_width()+"|";b=b+a.get_height()+"|";a=Splitter1.get_panes()[1].get_panes()[1];b=b+a.get_width()+"|";b=b+a.get_height()+"|";b=b+lastSelectedNode+"|";b=b+lastSelectedItems+"|";document.getElementById(hidStuff).value=b}function LoadTreeViewContextMenu(b,a){ContextMenuCallBack.Callback(a.get_node().get_id())}function LoadGridContextMenu(d,a){if(d.getSelectedItems().length==0){d.select(a.get_item(),false)}else{if(lastSelectedItems[0]!=a.get_item().getMember("EntryId").get_value()){d.select(a.get_item(),false)}}var e;if(TreeView1.get_selectedNode()){e=TreeView1.get_selectedNode().get_id()}else{e="ent0"}var c=d.getSelectedItems();var b=new Array();for(i=0;i<c.length;i++){b[b.length]="ent"+c[i].getMember("EntryId").get_value()}ContextMenuCallBack.Callback(e,b)}function OnCallBackError(b,a){}function tvCallbackComplete(b,a){repairTreeClasses()}function TreeViewNodeSelect(b,a){repairTreeClasses();if(lastSelectedNode!=a.get_node().get_id()){lastSelectedItems=null}lastSelectedNode=a.get_node().get_id();treeSelectionTitle=a.get_node().get_text();MenuCallBack.Callback(a.get_node().get_id());setTimeout("GridRedraw(true)",100);setTimeout("DetailsRedraw(true)",200);updateSizeBox()}function GridItemSelect(d,a){if(autoSelect){return}var e;if(TreeView1.get_selectedNode()){e=TreeView1.get_selectedNode().get_id()}else{e="ent0"}var c=new Array();c=d.getSelectedItems();lastSelectedItems=new Array();for(i=0;i<c.length;i++){lastSelectedItems[lastSelectedItems.length]=c[i].getMember("EntryId").get_value()}if(c.length==1){DetailsCallBack.Callback("ent"+c[0].getMember("EntryId").get_value());MenuCallBack.Callback(e,"ent"+c[0].getMember("EntryId").get_value());gridSelectionTitles=c[0].getMember("Title").get_value();selection=["ent"+c[0].getMember("EntryId").get_value()]}else{var b=new Array();gridSelectionTitles="";for(i=0;i<c.length;i++){b[b.length]="ent"+c[i].getMember("EntryId").get_value();gridSelectionTitles=gridSelectionTitles+", "+c[i].getMember("Title").get_value()}gridSelectionTitles=gridSelectionTitles.substring(2);selectionChanged=true;selection=b;MenuCallBack.Callback(e,b)}updateSizeBox()}function MenuBeforeCallback(b,a){selectionChanged=false}function MenuCallbackComplete(b,a){if(selectionChanged){var c;if(TreeView1.get_selectedNode()){c=TreeView1.get_selectedNode().get_id()}else{c="ent0"}MenuCallBack.Callback(c,selection)}}String.prototype.startsWith=function(a){return this.indexOf(a)==0};function GridItemDoubleClick(b,a){if(a.get_item().getMember("IsCollection").get_value()){if(a.get_item().getMember("ControlToLoad").get_value()=="Bring2mind/DMX/Views/AjaxThreePanel.ascx"){TreeView1.findNodeById("ent"+a.get_item().getMember("EntryId").get_value()).expand();TreeView1.findNodeById("ent"+a.get_item().getMember("EntryId").get_value()).select();if(Grid1){Grid1.dispose()}GridCallBack.Callback("ent"+a.get_item().getMember("EntryId").get_value());DetailsCallBack.Callback(a.get_item().getMember("EntryId").get_value())}else{window.location=baseUrl+baseUrlSuffix+"EntryId="+a.get_item().getMember("EntryId").get_value()}}else{if(a.get_item().getMember("EntryType").get_value().startsWith("Hyperlink")){window.open(appPath+"DesktopModules/Bring2mind/DMX/Download.aspx?PortalId="+portalId+"&EntryId="+a.get_item().getMember("EntryId").get_value(),"","")}if(a.get_item().getMember("EntryType").get_value().startsWith("File")){window.open(baseUrl+baseUrlSuffix+"Command=Core_Download&EntryId="+a.get_item().getMember("EntryId").get_value(),"","")}}updateSizeBox()}function CommandCallBackComplete(g,c){if(cbresult.result.isinerror=="true"){$("#"+divFeedbackFormId).attr("class","NormalRed");$("#"+divFeedbackFormId).html(cbresult.result.message);dlgFeedback.Show();return}else{if(cbresult.result.showpopup=="true"){$("#"+divFeedbackFormId).attr("class","");$("#"+divFeedbackFormId).html(cbresult.result.message);dlgFeedback.Show()}}var a=cbresult.result.command;var d=cbresult.result.argslist;var k;if(TreeView1.get_selectedNode()){k=TreeView1.get_selectedNode().get_id()}else{k="ent0"}switch(a){case"CopyToCB":MenuCallBack.Callback(k,d);break;case"CutToCB":MenuCallBack.Callback(k,d);break;case"RemoveFromCB":MenuCallBack.Callback(k,d);break;case"ClearCB":MenuCallBack.Callback(k,d);break;case"Delete":if(d==lastSelectedNode){window.location=baseUrl}else{var e=new Array();e=Grid1.getSelectedItems();for(i=0;i<e.length;i++){var f;f=TreeView1.findNodeById("ent"+e[i].getMember("EntryId").get_value());if(f){f.remove()}}MenuCallBack.Callback(k,d);Grid1.dispose();GridCallBack.Callback(k)}break;case"Recover":if(lastSelectedNode=="recyclebin"){MenuCallBack.Callback(k,"");Grid1.dispose();GridCallBack.Callback(k);DetailsCallBack.Callback("");lastSelectedItems=""}else{window.location=baseUrl+baseUrlSuffix+"EntryId="+lastSelectedNode}break;case"Move":for(i=0;i<selection.length;i++){Grid1.deleteItem(Grid1.getItemFromKey(0,selection[i].substring(3)))}selection=null;setTimeout("GridRedraw(false);",1000);if(draggedItem.getMember("EntryType").get_text()=="Collection"){var b=TreeView1.findNodeById(draggedItemId);var h=TreeView1.findNodeById(targetItemId);if(b){b.remove();if(h){h.get_nodes().add(b)}}}break;default:MenuCallBack.Callback(k,d);Grid1.dispose();GridCallBack.Callback(k)}}function GridItemsCommand(a,b){CommandCallBack.Callback(a,b)}function CallView(a){ViewCallBack.Callback($(window).width(),$(window).height(),a)}function ViewCallBackComplete(e,b){var c=document.getElementById("dlgView").style.height;if(c.indexOf("px")>-1){c=c.substring(0,c.indexOf("px"))}var a=parseInt(c);var d=a-42;dialogDiv=document.getElementById("dlgView_InnerSpan");dialogDiv.style.height=d+"px";dlgView.Show()}function editEntry(a,c,b){if(a=="-1"){EditCallBack.Callback("-1",c)}else{EditCallBack.Callback(a,b)}editEntryId=a;editParentId=c;Dialog1.Show()}function closedialog(){Dialog1.close();Grid1.dispose();GridCallBack.Callback(editParentId);TreeviewCallBack.Callback(editParentId);if(editEntryId!="-1"){DetailsCallBack.Callback(editEntryId)}}function formatFileSize(a){if(a>Math.pow(1024,3)){return parseInt(a/Math.pow(1024,3))+" GB"}else{if(a>Math.pow(1024,2)){return parseInt(a/Math.pow(1024,2))+" MB"}else{if(a>1024){return parseInt(a/1024)+" KB"}else{if(a==0){return""}else{return a+" B"}}}}}function openWord(a){var b=new ActiveXObject("Word.Application");if(b!=null){b.Visible=true;b.Documents.Open(a);b.WindowState=2;b.WindowState=1}}function openExcel(a){var b=new ActiveXObject("Excel.Application");if(b!=null){b.Visible=true;b.workbooks.Open(a);b.WindowState=2;b.WindowState=1}}function openPowerPoint(a){var b=new ActiveXObject("PowerPoint.Application");if(b!=null){b.Visible=true;b.Presentations.Open(a);b.WindowState=2;b.WindowState=1}}function openInfoPath(a){var b=new ActiveXObject("InfoPath.Application");if(b!=null){b.Visible=true;b.XDocuments.NewFromSolution(a);b.WindowState=2;b.WindowState=1}}function openPhotoshop(a){var b=new ActiveXObject("Photoshop.Application");if(b!=null){b.visible=true;b.Open(a);b.WindowState=2;b.WindowState=1}}function openDAVFolder(a){if(oWebFolder!=null){oWebFolder.navigateFrame(a,"_blank")}}function handleWheel(b,a){var d=b.PageSize;var c=b.RecordOffset;var e=b.RecordCount;if(e>d){var f=parseInt(a*-1*d/2);if(f+c>e){b.ScrollTo(e-d)}else{if(f+c<0){b.ScrollTo(0)}else{b.ScrollBy(f)}}}}function wheel(b){if(!b){b=window.event}var c=b.target||b.srcElement;c=Grid1;var a=0;if(b.wheelDelta){a=b.wheelDelta/120;if(window.opera){a=-a}}else{if(b.detail){a=-b.detail/3}}if(a){handleWheel(c,a)}if(b.preventDefault){b.preventDefault()}b.returnValue=false}function enableMouseWheel(b){var a=document.getElementById(b+"_dom");if(!a){return}if(a.addEventListener){a.removeEventListener("DOMMouseScroll",wheel,false);a.addEventListener("DOMMouseScroll",wheel,false)}else{a.onmousewheel=wheel}}function enableSelectAll(b){var a=document.getElementById(b+"_dom");if(!a){return}if(a.addEventListener){a.removeEventListener("onkeydown",selectAll,false);a.addEventListener("onkeydown",selectAll,false)}else{if(a.attachEvent){a.detachEvent("onkeydown",selectAll);a.attachEvent("onkeydown",selectAll)}else{dome.onkeydown=selectAll}}}function selectAll(a){if(!a){a=window.event}var d=a.target||a.srcElement;if(a.ctrlKey&&isKeyA(a.keyCode)){d=Grid1;if(d.RecordCount>1000){return false}for(var b=0;b<d.RecordCount;b++){var c=d.Table.GetRow(b);if(!c.Selected){d.Select(c,true)}}return false}return true}function isKeyA(a){return a==97||a==65}function openURLWindow(b){var a=window.open("","newwin","resizable=no,width=800,height=100");a.document.open();a.document.write("");a.document.write("<table width=90% align=center><tr><td>");a.document.write(b);a.document.write("<br><br><a href=# onClick=window.close();><b>Close</b></a>");a.document.write("</td></tr></table>");a.document.close();a.focus()}function TreeviewCallBackComplete(b,a){TreeviewRedraw(false)}function TreeviewRedraw(a){var b=document.getElementById(hidStuff).value.split("|");document.getElementById("TreeContainer").style.width=b[0]+"px";document.getElementById("TreeContainer").style.height=b[1]+"px";if(TreeView1){TreeView1.render();if(a&&lastSelectedNode){var c=TreeView1.findNodeById(lastSelectedNode);if(c){c.expand();c.select()}}}repairTreeClasses()}function repairTreeClasses(){$("table.TreeNode tbody tr td[vAlign=middle]:not([class])").attr("class",function(){return jQuery(this).parent().parent().parent().attr("class")});$("table.TreeNode tbody tr td[vAlign=middle]").removeClass("TreeNode");$("table.TreeNode").attr("class","TreeNode")}function GridCallBackComplete(b,a){GridRedraw(false);FixGridColumnWidths();Grid1.render();if(lastSelectedItems){autoSelect=true;for(i=0;i<lastSelectedItems.length;i++){selectGridRow(lastSelectedItems[i])}autoSelect=false}attachThumbnailRollovers()}function selectGridRow(a){for(j=0;j<Grid1.get_table().getRowCount();j++){if(Grid1.get_table().getRow(j).getMember("EntryId").get_value()==a){Grid1.select(Grid1.get_table().getRow(j),true)}}}function gridRenderComplete(b,a){var c=document.getElementById(hidStuff).value.split("|");document.getElementById(Grid1.get_id()+"_dom").style.height=(c[3]-29)+"px";document.getElementById(Grid1.get_id()+"_VerticalScrollDiv").style.height=(c[3]-57)+"px"}function GridRedraw(a){var b=document.getElementById(hidStuff).value.split("|");GridCallBack.element.style.width=(b[2]-2)+"px";Grid1.element.style.width=(b[2]-2)+"px";GridCallBack.element.style.height=b[3]+"px";document.getElementById(Grid1.get_id()+"_dom").style.height=(b[3]-52)+"px";if(a){if(lastSelectedNode){if(Grid1){Grid1.dispose();GridCallBack.Callback(lastSelectedNode)}}else{FixGridColumnWidths();Grid1.render()}}attachThumbnailRollovers()}function FixGridColumnWidths(){var c;var a;var b=Grid1.get_table().get_columns();for(c=0;c<b.length;c++){a=b[c];if(!a.get_fixedWidth()){a.set_width(0)}}}function DetailsCallBackComplete(b,a){DetailsRedraw(false)}function DetailsRedraw(a){var c=document.getElementById(hidStuff).value.split("|");if(a){if(lastSelectedItems){var b=lastSelectedItems;DetailsCallBack.Callback(b)}else{if(lastSelectedNode){DetailsCallBack.Callback(lastSelectedNode)}else{}}}}function loadEvent(){var a=document.getElementById(hidStuff).value.split("|");if(a[6].length>0){if(a[6].indexOf("undefined")==-1){lastSelectedNode=a[6]}}if(a[7].length>0){if(a[7].indexOf("undefined")==-1){lastSelectedItems=a[7].split(",")}}}function clearSearch(){txt1Search.value="";txt2Search.value="";txt3Search.value="";txt4Search.value="";txtQuickSearch.value="";TabStrip2.selectTabById("tabQuickSearch")}function showSearch(){if(lastSelectedNode!="searchresults"){lastSearchedNode=lastSelectedNode||-2}switch(TabStrip2.getSelectedTab().get_value()){case"regularsearch":var c="";for(i=0;i<rblScope.length;i++){var a=rblScope[i];if(a.type=="radio"&&a.checked){c=a.value;break}}CommandCallBack.Callback("RegularSearch",dd1Field.options[dd1Field.selectedIndex].value,dd1Selection.options[dd1Selection.selectedIndex].value,txt1Search.value,chk1Exact.checked,dd2Field.options[dd2Field.selectedIndex].value,dd2Selection.options[dd2Selection.selectedIndex].value,txt2Search.value,chk2Exact.checked,dd3Field.options[dd3Field.selectedIndex].value,dd3Selection.options[dd3Selection.selectedIndex].value,txt3Search.value,chk3Exact.checked,dd4Field.options[dd4Field.selectedIndex].value,dd4Selection.options[dd4Selection.selectedIndex].value,txt4Search.value,chk4Exact.checked,ddCombination.options[ddCombination.selectedIndex].value,chkAllVersions.checked,c,lastSearchedNode);break;default:var b="";for(i=0;i<rblFields.length;i++){var a=rblFields[i];if(a.type=="radio"&&a.checked){b=a.value;break}}var c="";for(i=0;i<rblScopeQ.length;i++){var a=rblScopeQ[i];if(a.type=="radio"&&a.checked){c=a.value;break}}CommandCallBack.Callback("QuickSearch",txtQuickSearch.value,b,c,lastSearchedNode)}Grid1.dispose();setTimeout("GridCallBack.Callback('searchresults');",1500);setTimeout("TreeView1.selectNodeById('searchresults');",1000);Dialog2.Close()}function checkvalue(){alert(rblScope.length)}function GridLoad(b,a){enableMouseWheel(grid1clientId);enableSelectAll(grid1clientId);isGridLoaded=true}function SplitterLoad(b,a){setTimeout("AfterSplitterLoad();",1500)}function AfterSplitterLoad(){TreeviewRedraw(isPostBack);GridRedraw(isPostBack);DetailsRedraw(isPostBack);isSplitterLoaded=true}function Dialog2_onShow(){setTimeout("txtQuickSearch.focus();",500)}function captureKeys(a){a=a||window.event;if(a!=undefined){kCode=a.keyCode||a.which;if(a.ctrlKey&&kCode==70||a.ctrlKey&&a.shiftKey&&kCode==70){Dialog2.Show();a.cancelBubble=true;a.returnValue=false}}}function dragDropNode(c,b){var a=b.get_node().get_id();var d=b.get_newParentNode().get_id();GridItemsCommand("Move",a+","+d);setTimeout("GridRedraw(false);",1000)}function dragDropGridItem(b,a){var c=a.get_targetControl().get_id();var d=a.get_target();var e;if(selection==null){selection=["ent"+a.get_item().getMember("EntryId").get_value()]}if(endsWith(c,"Grid1")){e="ent"+d.getMember("EntryId").get_text()}else{e=d.get_id()}if(e.substr(0,3)=="ent"){GridItemsCommand("Move",selection+","+e)}else{if(e.substr(0,3)=="cat"){GridItemsCommand("Move",selection+","+e);selection=null}else{alert(noPermission)}}}function endsWith(b,a){if(a.length>b.length){return false}return b.indexOf(a)==(b.length-a.length)}function dglViewResize(b,a){$("#dlgViewContent").width($("#dlgView_InnerSpan").width()-10);$("#dlgViewContent").height($("#dlgView_InnerSpan").height())}function DialogMaximize(a){$("#"+a).width($(window).width()).height($(window).height()).offset({left:0,top:0});$("#dlgView_InnerSpan").height($(window).height()-$("#dlgView_HeaderSpan").height()-$("#dlgView_FooterSpan").height());$("#dlgViewContent").width($("#dlgView_InnerSpan").width()-10);$("#dlgViewContent").height($("#dlgView_InnerSpan").height())}var PDFObject=function(l){if(!l||!l.url){return false}var m="1.2",k=l.id||false,s=l.width||"100%",h=l.height||"100%",n=l.pdfOpenParams,r,p,b,g,f,e,o,q,a,d,c;b=function(v){var t;try{t=new ActiveXObject(v)}catch(u){t=null}return t};g=function(){var t=null;if(window.ActiveXObject){t=b("AcroPDF.PDF");if(!t){t=b("PDF.PdfCtrl")}if(t!==null){return true}}return false};f=function(){var u,v=navigator.plugins,t=v.length,w=/Adobe Reader|Adobe PDF|Acrobat/gi;for(u=0;u<t;u++){if(w.test(v[u].name)){return true}}return false};e=function(){var t=navigator.mimeTypes["application/pdf"];return(t&&t.enabledPlugin)};o=function(){var t=null;if(f()||g()){t="Adobe"}else{if(e()){t="generic"}}return t};q=function(){var u=document.getElementsByTagName("html"),v,t;if(!u){return false}v=u[0].style;t=document.body.style;v.height="100%";v.overflow="hidden";t.margin="0";t.padding="0";t.height="100%";t.overflow="hidden"};a=function(t){var v="",u;if(!t){return v}for(u in t){if(t.hasOwnProperty(u)){v+=u+"=";if(u==="search"){v+=encodeURI(t[u])}else{v+=t[u]}v+="&"}}return v.slice(0,v.length-1)};d=function(t){var u=null;switch(t){case"url":u=r;break;case"id":u=k;break;case"width":u=s;break;case"height":u=h;break;case"pdfOpenParams":u=n;break;case"pluginTypeFound":u=p;break;case"pdfobjectversion":u=m;break}return u};c=function(t){if(!p){return false}var u=null;if(t){u=(t.nodeType&&t.nodeType===1)?t:document.getElementById(t);if(!u){return false}}else{u=document.body;q();s="100%";h="100%"}u.innerHTML='<object    data="'+r+'" type="application/pdf" width="'+s+'" height="'+h+'"></object>';return u.getElementsByTagName("object")[0]};r=encodeURI(l.url)+"#"+a(n);p=o();this.get=function(t){return d(t)};this.embed=function(t){return c(t)};this.pdfobjectversion=m;return this};
/*
* jQuery resize event - v1.1 - 3/14/2010
* http://benalman.com/projects/jquery-resize-plugin/
* 
* Copyright (c) 2010 "Cowboy" Ben Alman
* Dual licensed under the MIT and GPL licenses.
* http://benalman.com/about/license/
*/
(function($,m,l){var a=$([]),b=$.resize=$.extend($.resize,{}),k,g="setTimeout",f="resize",d=f+"-special-event",e="delay",h="throttleWindow";b[e]=250;b[h]=true;$.event.special[f]={setup:function(){if(!b[h]&&this[g]){return false}var n=$(this);a=a.add(n);$.data(this,d,{w:n.width(),h:n.height()});if(a.length===1){c()}},teardown:function(){if(!b[h]&&this[g]){return false}var n=$(this);a=a.not(n);n.removeData(d);if(!a.length){clearTimeout(k)}},add:function(n){if(!b[h]&&this[g]){return false}var p;function o(r,u,t){var s=$(this),q=$.data(this,d);q.w=u!==l?u:s.width();q.h=t!==l?t:s.height();p.apply(this,arguments)}if($.isFunction(n)){p=n;return o}else{p=n.handler;n.handler=o}}};function c(){k=m[g](function(){a.each(function(){var o=$(this),q=o.width(),p=o.height(),n=$.data(this,d);if(q!==n.w||p!==n.h){o.trigger(f,[n.w=q,n.h=p])}});c()},b[e])}})(jQuery,this);